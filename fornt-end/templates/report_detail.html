<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi ti·∫øt b√°o c√°o #{{ report.id }} - QuanLyTaiNan</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/report_detail.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="app">
        <!-- SIDEBAR -->
        <aside class="sidebar">
            <div class="brand">QuanLyTaiNan</div>
            <nav class="menu" aria-label="Main">
                <button class="menu-link" data-section="dashboard">üìä B·∫£ng ƒëi·ªÅu khi·ªÉn</button>
                <button class="menu-link" data-section="map">üó∫Ô∏è B·∫£n ƒë·ªì tai n·∫°n</button>
                <button class="menu-link" data-section="stats">üìà Th·ªëng k√™</button>
                <button class="menu-link" data-section="reports">üìã Danh s√°ch b√°o c√°o</button>
                <button class="menu-link" data-section="users">üë• Qu·∫£n l√Ω ng∆∞·ªùi d√πng</button>
                <button class="menu-link" data-section="notif">üîî Th√¥ng b√°o</button>
            </nav>
            <div class="bottom">
                <button class="btn-alert" id="btnEmergency">üö® B√°o c√°o kh·∫©n</button>
            </div>
        </aside>

        <main class="main">
            <div class="report-header">
                <div>
                    <h2>Chi ti·∫øt b√°o c√°o #{{ report.id }}</h2>
                    <p class="subtitle">Xem v√† qu·∫£n l√Ω th√¥ng tin chi ti·∫øt c·ªßa v·ª• tai n·∫°n</p>
                </div>
                <button id="backButton" class="btn-back"><i class="fas fa-arrow-left"></i> Quay l·∫°i</button>
            </div>

            <div class="report-details">
                <div class="info-section">
                    <h3>Th√¥ng tin c∆° b·∫£n</h3>
                    <p><strong>Th·ªùi gian:</strong> {{ vietnam_timestamp.strftime('%H:%M:%S %d-%m-%Y') if vietnam_timestamp else 'Kh√¥ng c√≥ th·ªùi gian' }}</p>
                    <p><strong>Lo·∫°i:</strong> Tai n·∫°n giao th√¥ng</p>
                    <p><strong>Khu v·ª±c:</strong> 
                        {% if lat is not none and lng is not none %}
                            <div>
                                <div style="font-weight:500;margin-bottom:2px;">{{ location_display }}</div>
                                <a href="https://maps.google.com/maps?q={{ lat }},{{ lng }}" target="_blank" 
                                   style="color:#6d28d9;text-decoration:underline;cursor:pointer;font-size:12px;"
                                   title="Xem v·ªã tr√≠ tr√™n Google Maps">
                                   üìç {{ lat }}, {{ lng }}
                                </a>
                            </div>
                        {% else %}
                            {{ location_display }}
                        {% endif %}
                    </p>
                    <p><strong>Tr·∫°ng th√°i:</strong> 
                        <span id="reportStatusBadge" class="badge">{{ report.status }}</span>
                    </p>
                    <div class="divider"></div>
                    <h3>Th√¥ng tin ng∆∞·ªùi b√°o c√°o</h3>
                    <p><strong>H·ªç v√† t√™n:</strong> {{ report.name }}</p>
                    <p><strong>CCCD:</strong> {{ report.cccd }}</p>
                    <p><strong>S·ªë ƒëi·ªán tho·∫°i:</strong> {{ report.phone }}</p>
                </div>

                <div class="description-section">
                    <h3>M√¥ t·∫£ chi ti·∫øt</h3>
                    <p>{{ report.description }}</p>
                    <div class="divider"></div>
                    <h3>H√¨nh ·∫£nh minh h·ªça</h3>
                    {% if report.image_filename %}
                        <img src="{{ url_for('uploaded_file', filename=report.image_filename) }}" alt="H√¨nh ·∫£nh tai n·∫°n" class="report-image">
                        <p style="font-size: 12px; color: #666;">ƒê∆∞·ªùng d·∫´n: {{ url_for('uploaded_file', filename=report.image_filename) }}</p>
                    {% else %}
                        <p>Kh√¥ng c√≥ h√¨nh ·∫£nh.</p>
                    {% endif %}
                </div>
            </div>

            <div class="action-section">
                <h3>C·∫≠p nh·∫≠t tr·∫°ng th√°i</h3>
                <form id="statusUpdateForm" method="POST">
                    <input type="hidden" name="report_id" value="{{ report.id }}">
                    <div class="status-form">
                        <select id="status-select" name="status">
                            <option value="ƒêang x·ª≠ l√Ω" {% if report.status == 'ƒêang x·ª≠ l√Ω' %}selected{% endif %}>ƒêang x·ª≠ l√Ω</option>
                            <option value="ƒê√£ x·ª≠ l√Ω" {% if report.status == 'ƒê√£ x·ª≠ l√Ω' %}selected{% endif %}>ƒê√£ x·ª≠ l√Ω</option>
                            <option value="Ch·ªù" {% if report.status == 'Ch·ªù' %}selected{% endif %}>Ch·ªù</option>
                        </select>
                        <button type="submit" id="updateStatusBtn" class="btn-primary"><i class="fas fa-sync-alt"></i> C·∫≠p nh·∫≠t</button>
                    </div>
                </form>
                <div id="statusMessage" class="status-message"></div>
            </div>
        </main>
    </div>

    <footer>AN TO√ÄN GIAO TH√îNG - H·∫†NH PH√öC C·ª¶A M·ªåI NH√Ä</footer>

    <script src="{{ url_for('static', filename='js/report_detail.js') }}"></script>
</body>
</html>